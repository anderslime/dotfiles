function run_normal_specs {
  echo "Running normal specs changed since master"
  bundle exec rspec $(git diff --name-only master..head | grep 'spec/' | xargs)
}

function run_fast_specs {
  echo "Running fast specs changed since master"
  bundle exec rspec $(git diff --name-only master..head | grep 'spec_fast/' | xargs)
}

if ! run_fast_specs || ! run_normal_specs; then
  echo "We've got some failing specs. STAP!"
else
  git push -u origin $(git_current_branch)
  hub pull-request
fi
